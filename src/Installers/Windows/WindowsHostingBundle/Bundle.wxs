<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util" xmlns:bal="http://wixtoolset.org/schemas/v4/wxs/bal">
    <Bundle Name="$(BundleName)" Version="$(BundleVersion)" Manufacturer="Microsoft Corporation" UpgradeCode="$(BundleUpgradeCode)">
        <BootstrapperApplication>
          <bal:WixStandardBootstrapperApplication LicenseUrl="https://go.microsoft.com/fwlink/?LinkId=329770" SuppressDowngradeFailure="yes" SuppressOptionsUI="yes" ThemeFile="bundle.thm" LocalizationFile="LCID\1033\thm.wxl" Theme="hyperlinkLicense" />
          <?foreach lcid in 2052;1028;1029;1031;3082;1033;1036;1040;1041;1042;1045;1046;1049;1055?>
          <Payload Id="PL_thm_$(lcid)" SourceFile="LCID\$(lcid)\thm.wxl" Name="$(lcid)\thm.wxl" Compressed="yes" />
          <?endforeach?>
          <Payload Name="DotNetLogo_256x.png" Compressed="yes" SourceFile="DotNetLogo_256x.png" />
          <Payload Name="dotnet.ico" Compressed="yes" SourceFile="dotnet.ico" />
        </BootstrapperApplication>

        <!-- Search references for upgrade policy keys -->
        <util:RegistrySearchRef Id="RemovePreviousVersionRegistryKeySearch" />
        <util:RegistrySearchRef Id="RemoveSpecificPreviousVersionRegistryKeyExistsSearch" />
        <util:RegistrySearchRef Id="RemoveSpecificPreviousVersionRegistryKeySearch" />

        <!-- Customizations of the default BA -->
        <Log Prefix="dd_$(BundleLogPrefix)_" Extension=".log" />
        <OptionalUpdateRegistration Manufacturer="$(BundleRegManufacturer)" ProductFamily="$(BundleRegFamily)" Name="$(BundleRegName)" />

        <!-- Bundle variables -->
        <Variable Name="BundleNameShort" Value="$(BundleNameShort)" Type="formatted" />
        <Variable Name="BundleNameSub" Value="$(BundleNameSub)" Type="formatted" />
        <Variable Name="OPT_NO_ANCM" bal:Overridable="yes" />
        <Variable Name="OPT_NO_SHAREDFX" bal:Overridable="yes" />
        <Variable Name="OPT_NO_RUNTIME" bal:Overridable="yes" />
        <Variable Name="OPT_NO_X86" bal:Overridable="yes" />
        <Variable Name="OPT_NO_SHARED_CONFIG_CHECK" bal:Overridable="yes" />

        <!-- Use values from the registry for switches, if the registry values are set & the user hasn't passed any switches from the command line -->

        <?define Options=OPT_NO_ANCM;OPT_NO_SHAREDFX;OPT_NO_RUNTIME;OPT_NO_X86;OPT_NO_SHARED_CONFIG_CHECK ?>
        <?define RegistrySeachCondition="NOT (OPT_NO_ANCM OR OPT_NO_ANCM=0 OR OPT_NO_SHAREDFX OR OPT_NO_SHAREDFX=0 OR OPT_NO_RUNTIME OR OPT_NO_RUNTIME=0 OR OPT_NO_X86 OR OPT_NO_X86=0 OR OPT_NO_SHARED_CONFIG_CHECK OR OPT_NO_SHARED_CONFIG_CHECK=0)" ?>

        <?foreach Option in $(Options) ?>
            <util:RegistrySearch Id="$(Option)_should_be_set" Condition="$(RegistrySeachCondition)" Root="HKLM" Key="Software\Microsoft\dotnet\host\options\$(MajorVersion).$(MinorVersion)" Value="$(Option)" Result="exists" Variable="$(Option)_Exists" />

            <util:RegistrySearch Condition="$(Option)_Exists" After="$(Option)_should_be_set" Root="HKLM" Key="Software\Microsoft\dotnet\host\options\$(MajorVersion).$(MinorVersion)" Value="$(Option)" Variable="$(Option)" Result="value" />
        <?endforeach?>

        <!-- These variables control the state of conditional UI text elements.
             They are disabled by default and enabled based on whether or not we detect that IIS is installed -->
        <Variable Name="IISEnabled" Value="0" Type="numeric" />

        <Chain ParallelCache="yes">
            <MsiPackage SourceFile="$(HostOptions.TargetPath)">
                <MsiProperty Name="OPT_NO_ANCM" Value="[OPT_NO_ANCM]" />
                <MsiProperty Name="OPT_NO_SHAREDFX" Value="[OPT_NO_SHAREDFX]" />
                <MsiProperty Name="OPT_NO_RUNTIME" Value="[OPT_NO_RUNTIME]" />
                <MsiProperty Name="OPT_NO_X86" Value="[OPT_NO_X86]" />
                <MsiProperty Name="OPT_NO_SHARED_CONFIG_CHECK" Value="[OPT_NO_SHARED_CONFIG_CHECK]" />
            </MsiPackage>
            <PackageGroupRef Id="PG_ANCM" />
            <PackageGroupRef Id="PG_DOTNET_REDIST_LTS_BUNDLE" />
            <!--<PackageGroupRef Id="PG_DOTNET_REDIST_FTS_BUNDLE" />-->
            <PackageGroupRef Id="PG_SHAREDFX_REDIST_BUNDLE" />
        </Chain>
    </Bundle>
</Wix>
