@using Microsoft.AspNetCore.Components.Routing;
@inherits NavLink

@{
    base.BuildRenderTree(__builder);
}

@code{

    protected override bool ShouldMatch(string currentUriAbsolute)
    {
        if (base.ShouldMatch(currentUriAbsolute))
        {
            return true;
        }

        var originalMatch = base.Match;
        base.Match = NavLinkMatch.All;
        string uriWithoutQueryAndFragment = GetUriIgnoreQueryAndFragment(currentUriAbsolute);
        var shouldMatch = base.ShouldMatch(uriWithoutQueryAndFragment);
        base.Match = originalMatch;
        return shouldMatch;
    }

    private string GetUriIgnoreQueryAndFragment(string uri) =>
        new Uri(uri).GetLeftPart(UriPartial.Path);
}
