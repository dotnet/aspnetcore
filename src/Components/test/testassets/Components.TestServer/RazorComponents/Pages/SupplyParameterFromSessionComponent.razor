@page "/supply-parameter-from-session"
@using Microsoft.AspNetCore.Components.Forms
@inject IHttpContextAccessor HttpContextAccessor
@inject NavigationManager NavigationManager

<h3>SupplyParameterFromSessionComponent</h3>

<p id="text-email">@Email</p>
<p id="text-another-email">@AnotherEmail</p>
<p id="text-null">@NoElement</p>
<p id="text-number">@Number</p>

<p id="text-testclass-email">@TestClassObject?.Email</p>
<p id="text-testclass-age">@TestClassObject?.Age</p>

<form @onsubmit="SetEmail" @formname="set-email" method="post">
    <AntiforgeryToken />
    <input id="input-email" @bind="EmailInput" name="EmailInput"/>
    <button type="submit" id="set-email">Set Email</button>
</form>

<form @onsubmit="SetAnotherEmail" @formname="set-another-email" method="post">
    <AntiforgeryToken />
    <input id="input-another-email" @bind="EmailInput" name="EmailInput" />
    <button type="submit" id="set-another-email">Set Email</button>
</form>

<form @onsubmit="SetNumber" @formname="set-number" method="post">
    <AntiforgeryToken />
    <input id="input-number" @bind="NumberInput" name="NumberInput" />
    <button type="submit" id="set-number">Set Number</button>
</form>

<form @onsubmit="SetEmailWithRedirect" @formname="set-email-redirect" method="post">
    <AntiforgeryToken />
    <input id="input-email-redirect" @bind="EmailInput" name="EmailInput" />
    <button type="submit" id="set-email-redirect">Set Email</button>
</form>

<form @onsubmit="SetTestClassObject" @formname="set-testclass-object" method="post">
    <AntiforgeryToken />
    <input id="input-testclass-email" @bind="EmailInput" name="EmailInput" />
    <input id="input-testclass-age" @bind="AgeInput" name="AgeInput" />
    <button type="submit" id="set-testclass-object">Set TestClass Object</button>
</form>

@code {
    [SupplyParameterFromSession]
    public string? Email { get; set; }

    [SupplyParameterFromSession(Name = "email")]
    public string? AnotherEmail { get; set; }

    [SupplyParameterFromSession]
    public string? NoElement { get; set; }

    [SupplyParameterFromSession]
    public int? Number { get; set; }

    [SupplyParameterFromForm]
    public string? EmailInput { get; set; }

    [SupplyParameterFromForm]
    public int? NumberInput { get; set; }

    [SupplyParameterFromForm]
    public int? AgeInput { get; set; }

    [SupplyParameterFromSession]
    public TestClass? TestClassObject { get; set; }

    void SetEmail()
    {
        Email = EmailInput;
        EmailInput = string.Empty;
        NavigationManager.NavigateTo("/subdir/supply-parameter-from-session", forceLoad: true);
    }

    void SetAnotherEmail()
    {
        AnotherEmail = EmailInput;
        EmailInput = string.Empty;
        NavigationManager.NavigateTo("/subdir/supply-parameter-from-session", forceLoad: true);
    }

    void SetNumber()
    {
        Number = NumberInput;
        NumberInput = null;
        NavigationManager.NavigateTo("/subdir/supply-parameter-from-session/navigation", forceLoad: true);
    }

    void SetEmailWithRedirect()
    {
        Email = EmailInput;
        EmailInput = string.Empty;
        NavigationManager.NavigateTo("/subdir/supply-parameter-from-session/navigation", forceLoad: true);
    }

    void SetTestClassObject()
    {
        if (TestClassObject == null)
        {
            TestClassObject = new TestClass();
        }
        TestClassObject.Email = EmailInput;
        TestClassObject.Age = AgeInput;
        EmailInput = string.Empty;
        AgeInput = null;
        NavigationManager.NavigateTo("/subdir/supply-parameter-from-session", forceLoad: true);
    }

    public class TestClass
    {
        public string? Email { get; set; }
        public int? Age { get; set; }
    }
}
